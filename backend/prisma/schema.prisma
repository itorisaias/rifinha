generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User Module
model User {
  id         Int       @id @default(autoincrement())
  name       String?
  password   String?
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now()) @updatedAt
  deleted_at DateTime?

  contacts Contact[]
  raffles Raffle[] @relation("RafflesOwner")
  wins    Raffle[] @relation("RafflesWin")
  quotas  Quota[]
}

model Contact {
  type                       ContactType
  value                      String      @unique
  confirmed_token            String
  confirmed_token_expierd_at DateTime
  confirmed_at               DateTime?
  created_at                 DateTime    @default(now())
  updated_at                 DateTime    @default(now()) @updatedAt
  deleted_at                 DateTime?
  user                       User        @relation(fields: [user_id], references: [id])
  user_id                    Int

  @@id([user_id, type])
}

// model Provider {

// }

// Raffle Module
model Raffle {
  id                          Int         @id @default(autoincrement())
  title                       String
  description                 String?
  slug                        String      @unique
  numbers_quantity            Int
  minimal_numbers             Int?
  maximum_numbeers            Int?
  location                    String?
  payment_date_at             DateTime?
  expiration_time_for_payment Int?
  type_of_draw                TypeOfDraw?
  start_at                    DateTime?
  finish_at                   DateTime?

  owner_id  Int
  owner     User  @relation("RafflesOwner", fields: [owner_id], references: [id])
  winner_id Int?
  winner    User? @relation("RafflesWin", fields: [winner_id], references: [id])

  rewards Reward[]
  yield   Yield?
  quotas  Quota[]
  // combos Combo[]

  created_at DateTime  @default(now())
  updated_at DateTime  @default(now()) @updatedAt
  deleted_at DateTime?
}

// status  da rifa
// medias para rifa
// winner

model Category {
  id    String @id @default(uuid())
  label String

  created_at DateTime  @default(now())
  updated_at DateTime  @default(now()) @updatedAt
  deleted_at DateTime?
}

// model Combo {
//   id String @id @default(uuid())
//   numbers_quantity Int
//   price Float
//   raffle_id Int
//   raffle Raffle @relation(fields: [raffle_id], references: [id])
// }

model Reward {
  id          String @id @default(uuid())
  description String
  price       Float
  raffle_id   Int    @unique
  raffle      Raffle @relation(fields: [raffle_id], references: [id])
}

model Yield {
  estimated_roi_percent Float?
  quota_price           Float?

  raffle_id Int    @unique
  raffle    Raffle @relation(fields: [raffle_id], references: [id])
}

model Quota {
  id          BigInt      @id @default(autoincrement())
  status      QuotaStatus @default(FREE)
  created_at  DateTime    @default(now())
  reserved_at DateTime?
  payed_at    DateTime?
  raffle_id   Int
  raffle      Raffle      @relation(fields: [raffle_id], references: [id])
  customer_id Int?
  customer    User?       @relation(fields: [customer_id], references: [id])
  payment_id  String?
  payment     Payment?
}

// Finance Module
model Payment {
  id String @id @default(uuid())

  quota_id BigInt @unique
  quota    Quota  @relation(fields: [quota_id], references: [id])

  last_check DateTime?
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now()) @updatedAt
}

// Enums and Types
enum PaymentStatus {
  PENDING
  PROCESSED
  DONE
  CANCELED
}

enum RaffleStatus {
  WAIT_PAYMENT
  PAYED
  CANCELED
}

enum QuotaStatus {
  FREE
  RESERVED
  PAYED
}

enum ContactType {
  EMAIL
  PHONE
  TEL_PHONE
  INSTAGRAM
  OTHER
}

enum TypeOfDraw {
  RANDOM
  PICK
}

// System settings
model Plan {
  id          String    @id @default(uuid())
  title       String
  description String
  // status // possivelmente para promoção
  fee         Float
  created_at  DateTime  @default(now())
  updated_at  DateTime  @default(now()) @updatedAt
  deleted_at  DateTime?
}
